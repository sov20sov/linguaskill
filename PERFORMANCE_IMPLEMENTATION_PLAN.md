# خطة تنفيذ تحسين أداء الموقع (Performance 61 → 90+)

**الوضع الحالي:** 61/100  
**الهدف:** 90+/100 (المنطقة الخضراء)

---

## المرحلة 1: إعادة الاختبار في وضع التخفي

- تشغيل Lighthouse في نافذة خاصة (Incognito) بدون إضافات.
- التأكد من أن القياس على إصدار الإنتاج (`npm run build` ثم `npm run preview` أو على Vercel).
- تسجيل الأرقام الحالية (LCP, TBT, Speed Index, FCP) كخط أساس.

---

## المرحلة 2: تحسين LCP و Speed Index (الأولوية القصوى + الصور/الفيديو)

| الإجراء | الملف / المكون | التفاصيل |
|--------|-----------------|----------|
| **أولوية تحميل الفيديو** | `index.html` | إضافة `<link rel="preload" as="video" href="/videos/videoforhero.mp4">` حتى يبدأ المتصفح بتحميل الفيديو فوراً. |
| **فيديو Hero** | `components/Hero.tsx` | تغيير `preload="metadata"` إلى `preload="auto"` وإزالة `loading="lazy"` من الفيديو (عنصر LCP) حتى لا يتأخر تحميله. |
| **تحويل الصور إلى WebP** | `public/images/` | تحويل `iconhead.png` إلى WebP (يدوياً أو بأداة مثل [Squoosh](https://squoosh.app)) ثم إضافة `<link rel="icon" type="image/webp" href="/images/iconhead.webp">` في `index.html` مع الإبقاء على رابط PNG كاحتياطي. |
| **صور تحت الطية** | `components/About.tsx` | الصورة الحالية خارجية (Unsplash) مع `loading="lazy"` — إبقاؤها مع التأكد من وجود أبعاد ثابتة (مثلاً `width`/`height` أو `aspect-ratio`) للحفاظ على CLS. |

**النتيجة المتوقعة:** تحسن واضح في LCP و Speed Index.

---

## المرحلة 3: تقليل TBT (Code Splitting + تأجيل JS الثقيل)

| الإجراء | الملف / المكون | التفاصيل |
|--------|-----------------|----------|
| **تأجيل تحميل Particles (ogl)** | `components/Hero.tsx` | تحميل مكون `Particles` بشكل كسول (`React.lazy`) مع `Suspense` و fallback بسيط (شكل أو لون ثابت) حتى يُحمّل **ogl** بعد أول رسم للصفحة ولا يطيل TBT. |
| **حدود Suspense منفصلة** | `App.tsx` | بدلاً من Suspense واحد يلف كل المكونات، فصل حدود: مثلاً About أولاً، ثم Features و Impact و Courses و Methodology و Testimonials و Contact و Footer في حدود منفصلة أو مجموعة ثانية حتى لا يُحمّل كل الكود دفعة واحدة. |
| **عزل المكتبات في chunks** | `vite.config.ts` | التأكد من `manualChunks`: `react-vendor` و `ogl-vendor` (موجود مسبقاً). إضافة أي مكتبة كبيرة أخرى في chunk منفصل إن وُجدت. |

**النتيجة المتوقعة:** انخفاض TBT وتقليل "تجميد" الصفحة.

---

## المرحلة 4: مراجعة وحذف المكتبات غير المستخدمة

| الإجراء | الحالة | التفاصيل |
|--------|--------|----------|
| **@types/nodemailer** | غير مستخدم | المشروع يستخدم Resend وليس Nodemailer — إزالته من `package.json`. |
| **express-validator** | غير مستخدم في الكود | التحقق يتم عبر `utils/contact-validation.ts` — إزالته من `package.json` إن لم يُستدعَ في أي ملف. |
| **مراجعة باقي الحزم** | مراجعة | التأكد من عدم وجود حزم أخرى غير مستخدمة في الـ Frontend أو الـ Backend. |

**النتيجة المتوقعة:** تقليص حجم `node_modules` وتقليل احتمال دخول كود غير مستخدم في الحزمة.

---

## المرحلة 5: البنية التحتية (Vite & Vercel)

| الإجراء | التفاصيل |
|--------|----------|
| **فصل ملفات النظام** | تم في `vite.config.ts` عبر `manualChunks` — الاستمرار في عزل React و ogl في chunks منفصلة. |
| **الضغط (Brotli)** | Vercel يضغط الملفات تلقائياً (Brotli/Gzip). التأكد من عدم تعطيل الضغط. |
| **CLS** | الحفاظ على أبعاد ثابتة للصور والفيديو (مثلاً `aspect-ratio` أو `width`/`height`) لتفادي القفزات. |

---

## ترتيب التنفيذ

1. **المرحلة 1** — إعادة قياس في التخفي (يدوي).  
2. **المرحلة 2** — preload الفيديو + إصلاح خصائص فيديو Hero + WebP للفافيكون.  
3. **المرحلة 3** — Lazy load لـ Particles + تحسين حدود Suspense في App.  
4. **المرحلة 4** — إزالة الحزم غير المستخدمة.  
5. **المرحلة 5** — مراجعة نهائية لـ Vite/Vercel و CLS.

بعد التنفيذ يُفضّل إعادة تشغيل Lighthouse في التخفي ومقارنة النتائج.
